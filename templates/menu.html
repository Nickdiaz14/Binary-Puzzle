<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.6">
    <title>Menu</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="logo-gradiente"></div>
    <div style="text-align:center;">
        <h1 id="title" style="font-size: 60px; font-weight: bold;">¡Hola, {{ nickname }}!</h1>
    </div>
    <div style="text-align:center; margin: 20px;">
        <h1 id="title1" style="font-size: 26px; font-weight: bold;">Juegos</h1>
        <select id="game" style="padding: 1px; font-size: 26px; font-weight: bold;text-align: center; border-radius: 8px; cursor: pointer; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);" onchange="handleGameChange()">
            <option value="0h-h1" selected>0h-h1</option>
            <option value="ChessGames">ChessGames</option>
            <option value="MindGrid">MindGames</option>
            <option value="0h-n0">0h-n0</option>
            <option value="MathGames">MathGames</option>
        </select>
    </div>
    <div style="text-align:center;">
        <!-- Menú Juego 1 (0h-h1) -->
        <div id="game1-menu" style="text-align:center;">
            <div class="rules-section">
            <button class="rules-toggle" onclick="toggleRules()">REGLAS</button>
            <div class="rules-content" id="rulesContent">
                <div class="rule-item">
                    <span class="rule-number">1.</span>Todo el tablero debe estar lleno.
                </div>
                <div class="rule-item">
                    <span class="rule-number">2.</span>Cada fila y columna debe tener igual número de celdas de cada color.
                </div>
                <div class="rule-item">
                    <span class="rule-number">3.</span>No puede haber tres celdas consecutivas del mismo color.
                </div>
                <div class="rule-item">
                    <span class="rule-number">4.</span>No puede haber dos filas o columnas idénticas.
                </div>
            </div>
        </div>
            <div class="botones">
                <button data-url="/0hh1" class="resolver azulito">0h-h1</button>
                <button data-url="/time_trial_0hh1" class="resolver rojito">Contrarreloj</button>
            </div>
            <div class="botones">
                <button data-url="/tutorial" class="resolver rojito">Tutorial</button>
                <button data-url="/leaderboards" class="resolver azulito">Rankings</button>
            </div>
        </div>

        <!-- Menú Juego 2 (ChessGames) -->
        <div id="game2-menu" style="text-align:center; display: none;">
            <div class="botones">
                <button data-url="/knight" class="resolver azulito">Knight</button>
                <button data-url="/leaderboards" class="resolver rojito">Rankings</button>
            </div>
        </div>

        <!-- Menú Juego 3 (MindGames) -->
        <div id="game3-menu" style="text-align:center; display: none;">
            <div class="botones">
                <button data-url="/memory" class="resolver azulito" style="width: 150px;">Secuenzo</button>
                <button data-url="/speed" class="resolver rojito" style="width: 150px;">CuentaManía</button>
                <button data-url="/sequence" class="resolver azulito" style="width: 150px;">Patrón Perfecto</button>
            </div>
            <div class="botones">
                <button data-url="/colors" class="resolver rojito" style="width: 150px;">Colores Cruzados</button>
                <button data-url="/leaderboards" class="resolver azulito" style="width: 150px;">Rankings</button>
            </div>
        </div>

        <!-- Menú Juego 4 (0hn0) -->
        <div id="game4-menu" style="text-align:center; display: none;">
            <div class="rules-section">
            <button class="rules-toggle" onclick="toggleRules()">REGLAS</button>
            <div class="rules-content" id="rulesContent_1">
            </div>
        </div>
            <div class="botones">
                <button data-url="/0hn0" class="resolver rojito">0h n0</button>
                <button data-url="/tutorial_0hn0" class="resolver azulito">Tutorial</button>
            </div>
            <div class="botones">
                <button data-url="/leaderboards" class="resolver rojito">Rankings</button>
            </div>
        </div>

        <!-- Menú Juego 5 (MathGames)) -->
        <div id="game5-menu" style="text-align:center; display: none;">
            <div class="botones">
                <button data-url="/nerdle" class="resolver rojito">Nerdle</button>
                <button data-url="/leaderboards" class="resolver azulito">Rankings</button>
            </div>
        </div>


        <h1 id="title" style="margin-top: 20px; font-size: 27px; font-weight: bold;">Ajustes</h1>

        <div style="text-align:center;" class="botones">
            <button id="theme-toggle" class="resolver azulito">Cambiar Tema</button>
            <button data-url="/?ch=si" class="resolver rojito">Cambiar nombre</button>
        </div>  
        <div style="display: flex; align-items: center; gap: 10px; margin-left: 170px;margin-top: 30px;">
            <a href="https://www.instagram.com/math_and_beer" target="_blank">
                <img id="image1" src="{{ url_for('static', filename='images/instagram.png') }}" style="width: 24px;">
            </a>
            <a id="link" href="https://www.instagram.com/math_and_beer" target="_blank" style="font-size: 15px; font-weight: bold; text-decoration: none;">
                @ math_and_beer
            </a>
        </div>
    </div>
    <audio id="sonido-boton" src="{{ url_for('static', filename='sounds/click.mp3') }}"></audio>
    <script>
        const gameSelected = document.getElementById("game");
        const link = document.getElementById("link");
        const div1 = document.getElementById("game");
        const image = document.getElementById("image");
        const image1 = document.getElementById("image1");

        let color0 = "", color01 = "", color1 = "";

        function handleGameChange() {
            localStorage.setItem("gameSelected", gameSelected.value);
            const gameSelect = gameSelected.value;
            document.getElementById("game1-menu").style.display = "none";
            document.getElementById("game2-menu").style.display = "none";
            document.getElementById("game3-menu").style.display = "none";
            document.getElementById("game4-menu").style.display = "none";
            document.getElementById("game5-menu").style.display = "none";

            if (gameSelect === "0h-h1") {
                document.getElementById("game1-menu").style.display = "block";
            } else if (gameSelect === "ChessGames") {
                document.getElementById("game2-menu").style.display = "block";
            } else if (gameSelect === "MindGrid") {
                document.getElementById("game3-menu").style.display = "block";
            } else if (gameSelect === "0h-n0") {
                document.getElementById("game4-menu").style.display = "block";
            } else if (gameSelect === "MathGames") {
                document.getElementById("game5-menu").style.display = "block";
            }
        }

        function toggleRules() {
            const rulesContent = gameSelected.value === "0h-h1" ? document.getElementById('rulesContent'):
                                   document.getElementById('rulesContent_1');
            
            if (rulesContent.style.display === 'none' || rulesContent.style.display === '') {
                // Mostrar con animación
                rulesContent.style.display = 'block';
                rulesContent.classList.remove('fade-out');
                rulesContent.classList.add('fade-in');
            } else {
                // Ocultar con animación
                rulesContent.classList.remove('fade-in');
                rulesContent.classList.add('fade-out');
                
                // Ocultar después de la animación
                setTimeout(() => {
                    rulesContent.style.display = 'none';
                    rulesContent.classList.remove('fade-out');
                }, 300); // 300ms coincide con la duración de la animación
            }
            if (gameSelected.value === "0h-n0") {
                rulesContent.innerHTML = `
                <div class="rule-item"><span class="rule-number">1.</span>Todo el tablero debe estar lleno.</div>
                <div class="rule-item"><span class="rule-number">2.</span>Las celdas ${color0} bloquean la vista en cualquier dirección.</div>
                <div class="rule-item"><span class="rule-number">3.</span>Las celdas ${color1} con número indican cuántas celdas ${color1} pueden ver en línea recta, sin que una ${color01} las bloquee.</div>
                <div class="rule-item"><span class="rule-number">4.</span>Todos los números deben cumplirse exactamente.</div>`;
            }
        }

        function applyTheme(theme) {
            const gameSelected = document.getElementById("game");
            document.body.classList.remove("light-theme", "dark-theme");
            if (theme) document.body.classList.add(theme);

            if (theme === "light-theme") {
                color0 = "rojas"; color01 = "roja"; color1 = "azules";
                link.style.color = "#000000";
                //image.style.filter = "none";
                image1.style.filter = "none";
                div1.style.background = "#fffde6";
                div1.style.color = "#000000";
                div1.style.border = "1px solid #121212";
            } else if (theme === "dark-theme") {
                color0 = "amarillas"; color01 = "amarilla"; color1 = "azules";
                link.style.color = "#ffffff";
                //image.style.filter = "invert(90%)";
                image1.style.filter = "invert(90%)";
                div1.style.background = "#000112";
                div1.style.color = "#ffffff";
                div1.style.border = "1px solid #ccc";
            } else {
                color0 = "amarillas"; color01 = "amarilla"; color1 = "moradas";
                link.style.color = "#ffffff";
                //image.style.filter = "invert(90%)";
                image1.style.filter = "invert(90%)";
                div1.style.background = "#15003e";
                div1.style.color = "#ffffff";
                div1.style.border = "1px solid #ccc";
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            const savedGame = localStorage.getItem("gameSelected");
            const sonido = document.getElementById("sonido-boton");
            if (savedGame) gameSelected.value = savedGame;
            handleGameChange();

            const savedTheme = localStorage.getItem("theme");
            applyTheme(savedTheme);

            document.getElementById("theme-toggle").addEventListener("click", () => {
                const current = document.body.classList.contains("dark-theme") ? "dark-theme"
                            : document.body.classList.contains("light-theme") ? "light-theme"
                            : "";
                const next = current === "" ? "dark-theme"
                            : current === "dark-theme" ? "light-theme"
                            : "";
                if (next) {
                    document.body.classList.add(next);
                    localStorage.setItem("theme", next);
                } else {
                    localStorage.removeItem("theme");
                }
                applyTheme(next);
            });
            document.querySelectorAll(".resolver").forEach(boton => {
                boton.addEventListener("click", function (e) {
                    e.preventDefault(); // Detiene redirección inmediata
                    let url = this.getAttribute("data-url");

                    if (url === "/leaderboards") {
                        const game = document.getElementById("game").value;
                        url = `/leaderboards?userID=${localStorage.getItem('userId')}&game=${game}`;
                    } else if (url === "/") {
                        
                    }


                    sonido.currentTime = 0;
                    sonido.volume = 0.2; // Ajusta el volumen si es necesario
                    sonido.play();
                    if (!url) return;

                    setTimeout(() => {
                        window.location.href = url;
                    }, 200); // Ajusta si el sonido es más largo
                });
            });
        });
    </script>
</body>
</html>
